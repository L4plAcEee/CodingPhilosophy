## Daily::每日一题 @[P1116 车厢重组](https://www.luogu.com.cn/problem/P1116)
### 题目描述
在一个旧式的火车站旁边有一座桥，其桥面可以绕河中心的桥墩水平旋转。一个车站的职工发现桥的长度最多能容纳两节车厢，如果将桥旋转 180 度，则可以把相邻两节车厢的位置交换，用这种方法可以重新排列车厢的顺序。于是他就负责用这座桥将进站的车厢按车厢号从小到大排列。他退休后，火车站决定将这一工作自动化，其中一项重要的工作是编一个程序，输入初始的车厢顺序，计算最少用多少步就能将车厢排序。

### 思路
想一想情况：
最优情况：类似 $a[1, 3, 2]$ 的序列，只需要一次 $swap$ 操作即可。
最坏情况：类似 $a[3,2,1]$ 的序列，需要三次 $swap$ 操作：
	1. $a[3,2,1]$ -> $a[2,3,1]$
	2. $a[2,3,1]$ -> $a[2,1,3]$
	3. $a[2,1,3]$ -> $a[1,2,3]$
看了一眼
似乎就是冒泡？
先直接模拟冒泡行为看看吧？ 数据量不大 $N(≤10000)$

### 提交 #1 <100pt>
哈哈，我是↑↓。
![](https://l4p-bucket-1.oss-cn-shenzhen.aliyuncs.com/img/b300745cbf47baae4ab3331997c0e8dc_MD5.jpeg)
tmd 我本地的编译器默认行为是设置 0 搞得我调试半天没看出哪里问题。

### 关键代码
```cpp
void solve() {
    cin >> N;
    int cnt = 0;
    vector<int> v(N);
    for (auto &n : v) cin >> n;
    for (int i = 0; i < N; ++i) {
        for (int j = 1; j < N; ++j) {
            if (v[j] < v[j - 1]) {
                cnt++;
                swap(v[j], v[j - 1]);
            }
        }
    }
    cout << cnt;
}
```

### 关键点
#### 逆序对与交换次数的关系
##### 结论
> 在只能交换相邻元素的情况下，  
> **最少交换次数 = 逆序对数。**
###### 为什么逆序对数量等于最少交换次数？
思考这样一个场景：
- 每次只能**交换相邻的两节车厢**。
- 要把所有车厢排成**升序**。
那么一个较大的车厢，如果它前面有比它小的车厢，就需要**一路往后挪**。 每交换一次，它就和它后面的小车厢的逆序对减少一个。
**一次交换，只能消除一个逆序对。**
最终目标是让**所有逆序对都消除掉**，数组变成升序，所以：
> **总交换次数 = 逆序对总数。**

> 所以：在只能交换相邻元素的情况下，**每次交换消除1个逆序对**，**最少交换次数就是逆序对数量**。

### 优化 #1
**用冒泡排序时间复杂度是 $O(N^2)$**，对于 $N \le 10000$，在极限数据下会**超时**。
用**归并排序**可以在 $O(N \log N)$ 时间里统计逆序对数量。
```cpp
const int MAXN = 1e4 + 5;
int N, a[MAXN], tmp[MAXN];
long long cnt = 0;

void merge_sort(int l, int r) {
    if (l >= r) return;
    int mid = (l + r) / 2;
    merge_sort(l, mid);
    merge_sort(mid + 1, r);
    int i = l, j = mid + 1, k = l;
    while (i <= mid && j <= r) {
        if (a[i] <= a[j]) tmp[k++] = a[i++];
        else {
            tmp[k++] = a[j++];
            cnt += mid - i + 1; // 关键：逆序对增加
        }
    }
    while (i <= mid) tmp[k++] = a[i++];
    while (j <= r) tmp[k++] = a[j++];
    for (int p = l; p <= r; ++p) a[p] = tmp[p];
}
```

### 后记
用一句通俗易懂的话来说：实际上就是统计要发生多少次交换行为。
用正式一点的话来说：
在本题这种**只能交换相邻元素**的条件下，  
**逆序对数量**恰好就是最终**需要发生的总交换次数**。

换句话说，就是统计：
> 要把所有元素移动到正确位置，总共需要多少次**相邻交换**操作。

---
